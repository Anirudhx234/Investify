package com.investify.backend.config;

import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.HttpMethod;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.www.BasicAuthenticationFilter;

@RequiredArgsConstructor
@Configuration
@EnableWebSecurity
public class SecurityConfig {

    private final ClientAuthenticationEntryPoint clientAuthenticationEntryPoint;
    private final ClientAuthenticationProvider clientAuthenticationProvider;

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
                .exceptionHandling().authenticationEntryPoint(clientAuthenticationEntryPoint)
                .and()
                .addFilterBefore(new JwtAuthFilter(clientAuthenticationProvider), BasicAuthenticationFilter.class)
                .csrf().disable()
                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)
                .and()
                .authorizeHttpRequests((requests) -> requests
                        // Allow access to signup, login, and verification without authentication
                        .requestMatchers(HttpMethod.POST, "/api/auth/login", "/api/auth/signup","/api/auth/forgot-password").permitAll()
                        .requestMatchers(HttpMethod.PATCH, "/api/auth/reset-password").permitAll()
                        .requestMatchers(HttpMethod.GET, "/api/auth/verify-email", "/api/assets").permitAll()
                        .anyRequest().authenticated())
        ;
        return http.build();
    }
}


/*
{"data":[{"symbol":"000","name":"Greenvolt - Energias Renováveis, S.A.","currency":"EUR","exchange":"FSX","mic_code":"XFRA","country":"Germany","type":"Common Stock","figi_code":"BBG011RFH095"},{"symbol":"000","name":"Greenvolt - Energias Renovaveis SA","currency":"EUR","exchange":"XBER","mic_code":"XBER","country":"Germany","type":"Common Stock","figi_code":"BBG011RFH0G7"},{"symbol":"000","name":"Greenvolt - Energias Renováveis, S.A.","currency":"EUR","exchange":"Munich","mic_code":"XMUN","country":"Germany","type":"Common Stock","figi_code":"BBG011RFH0F8"},{"symbol":"000","name":"Greenvolt - Energias Renovaveis SA","currency":"EUR","exchange":"XDUS","mic_code":"XDUS","country":"Germany","type":"Common Stock","figi_code":"BBG011RFH0B2"},{"symbol":"000001","name":"Ping An Bank Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZDQD3"},{"symbol":"000002","name":"China Vanke Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZB0Z8"},{"symbol":"000004","name":"Shenzhen GuoHua Network Security Technology Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZFTX3"},{"symbol":"000006","name":"Shenzhen Zhenye ","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZFRZ5"},{"symbol":"000007","name":"Shenzhen Quanxinhao Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZDNB2"},{"symbol":"000008","name":"China High-Speed Railway Technology Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZGN01"},{"symbol":"000009","name":"China Baoan Group Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZDLT7"},{"symbol":"000010","name":"Shenzhen Ecobeauty Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000P6HP77"},{"symbol":"000011","name":"Shenzhen Properties \u0026 Resources Development ","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZDKR1"},{"symbol":"000012","name":"CSG Holding Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZ9LD9"},{"symbol":"000014","name":"Shahe Industrial Co., Ltd","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZBX31"},{"symbol":"000016","name":"Konka Group Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZCNJ5"},{"symbol":"000017","name":"Shenzhen China Bicycle Company ","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZDHB5"},{"symbol":"000019","name":"Shenzhen Cereals Holdings Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZDGJ9"},{"symbol":"000020","name":"Dongwha Pharm.Co.,Ltd","currency":"KRW","exchange":"KRX","mic_code":"XKRX","country":"South Korea","type":"Common Stock","figi_code":"BBG000BDH7Q6"},{"symbol":"000020","name":"Shenzhen Zhongheng Huafa Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZDTP4"},{"symbol":"000021","name":"Shenzhen Kaifa Technology Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZDWT3"},{"symbol":"000025","name":"Shenzhen Tellus Holding Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZFXD6"},{"symbol":"000026","name":"FIYTA Precision Technology Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZFPT6"},{"symbol":"000027","name":"Shenzhen Energy Group Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZDY91"},{"symbol":"000028","name":"China National Accord Medicines Corporation Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZFNP5"},{"symbol":"000029","name":"Shenzhen Special Economic Zone Real Estate \u0026 Properties ","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZDFG4"},{"symbol":"000030","name":"FAWER Automotive Parts Limited Company","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZFMM0"},{"symbol":"000031","name":"Grandjoy Holdings Group Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZDC62"},{"symbol":"000032","name":"Shenzhen SED Industry Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZD9V1"},{"symbol":"000034","name":"Digital China Group Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZFLS6"},{"symbol":"000035","name":"China Tianying Inc.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZ9B14"},{"symbol":"000036","name":"China Union Holdings Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000P6K522"},{"symbol":"000037","name":"Shenzhen Nanshan Power Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000P6HMS1"},{"symbol":"000039","name":"China International Marine Containers ","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000BZ9Y78"},{"symbol":"000040","name":"KR Motors Co., Ltd.","currency":"KRW","exchange":"KRX","mic_code":"XKRX","country":"South Korea","type":"Common Stock","figi_code":"BBG000BPJWM6"},{"symbol":"000040","name":"Tunghsu Azure Renewable Energy Co.,Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000P6K3R0"},{"symbol":"000042","name":"Shenzhen Centralcon Investment Holding Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000P6HH84"},{"symbol":"000045","name":"Shenzhen Textile ","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000P6FV94"},{"symbol":"000048","name":"Shenzhen Kingkey Smart Agriculture Times Co.,Ltd","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000P6K1H5"},{"symbol":"000049","name":"Shenzhen Desay Battery Technology Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000P6HC94"},{"symbol":"000050","name":"Kyungbang Co.,Ltd","currency":"KRW","exchange":"KRX","mic_code":"XKRX","country":"South Korea","type":"Common Stock","figi_code":"BBG000BDPSY2"},{"symbol":"000050","name":"Tianma Microelectronics Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000P6H964"},{"symbol":"000055","name":"China Fangda Group Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000P66001"},{"symbol":"000056","name":"Shenzhen Wongtee International Enterprise Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000P6H866"},{"symbol":"000058","name":"Shenzhen SEG Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000P6H6Y9"},{"symbol":"000059","name":"North Huajin Chemical Industries Co.,Ltd","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000D3ZN81"},{"symbol":"000060","name":"Shenzhen Zhongjin Lingnan Nonfemet Co. Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000D425S2"},{"symbol":"000061","name":"Shenzhen Agricultural Products Group Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000P6H5M4"},{"symbol":"000062","name":"Shenzhen Huaqiang Industry Co., Ltd.","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000D423R8"},{"symbol":"000063","name":"ZTE Corporation","currency":"CNY","exchange":"SZSE","mic_code":"XSHE","country":"China","type":"Common Stock","figi_code":"BBG000GC4ZY6"}],"count":141848,"status":"ok"}
 */